"use strict";(self.webpackChunkparasola=self.webpackChunkparasola||[]).push([[9247],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>y});var r=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=r.createContext({}),p=function(e){var t=r.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},u=function(e){var t=p(e.components);return r.createElement(s.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),c=p(a),m=n,y=c["".concat(s,".").concat(m)]||c[m]||d[m]||i;return a?r.createElement(y,l(l({ref:t},u),{},{components:a})):r.createElement(y,l({ref:t},u))}));function y(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,l=new Array(i);l[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[c]="string"==typeof e?e:n,l[1]=o;for(var p=2;p<i;p++)l[p]=a[p];return r.createElement.apply(null,l)}return r.createElement.apply(null,a)}m.displayName="MDXCreateElement"},2093:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>d,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var r=a(7462),n=(a(7294),a(3905));const i={},l="Multipart Uploads With Binary Parts",o={unversionedId:"guides/multipart-uploads-with-binary-parts",id:"guides/multipart-uploads-with-binary-parts",title:"Multipart Uploads With Binary Parts",description:"This guide describes how to upload a binary by manually orchestrating the binary parts yourself.",source:"@site/docs/guides/multipart-uploads-with-binary-parts.md",sourceDirName:"guides",slug:"/guides/multipart-uploads-with-binary-parts",permalink:"/guides/multipart-uploads-with-binary-parts",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"guides",previous:{title:"Introduction to Asset Management",permalink:"/guides/introduction-to-asset-management"},next:{title:"Creating Artifacts",permalink:"/guides/creating-artifact-versions"}},s={},p=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Picking a Target Part Size",id:"picking-a-target-part-size",level:2},{value:"Creating a Part",id:"creating-a-part",level:2},{value:"Uploading a Part",id:"uploading-a-part",level:2},{value:"Listing Parts",id:"listing-parts",level:2}],u={toc:p},c="wrapper";function d(e){let{components:t,...a}=e;return(0,n.kt)(c,(0,r.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"multipart-uploads-with-binary-parts"},"Multipart Uploads With Binary Parts"),(0,n.kt)("p",null,"This guide describes how to upload a binary by manually orchestrating the binary parts yourself."),(0,n.kt)("admonition",{title:"higher level abstractions",type:"info"},(0,n.kt)("p",{parentName:"admonition"},"It is strongly recommend to avoid this complexity whenever possible by using the CLI instead as documented in the ",(0,n.kt)("a",{parentName:"p",href:"introduction-to-asset-management#creating-a-binary"},"creating a binary")," section of the introduction to asset management.")),(0,n.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/peridio/morel/releases"},"Peridio CLI"),".",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Last tested with version 0.8.0.")))),(0,n.kt)("h2",{id:"picking-a-target-part-size"},"Picking a Target Part Size"),(0,n.kt)("p",null,"Assuming you have already ",(0,n.kt)("a",{parentName:"p",href:"creating-binaries"},"created a binary"),", the next step in using binary parts to perform a multipart upload is deciding on a target part size. The target part size is the size that you will try to make all binary parts."),(0,n.kt)("p",null,"This can be reasoned about with this equation:"),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"total_parts = ceil(binary_size / target_size)")),(0,n.kt)("p",null,"You can use up to 1000 parts and each part must have a size between 5 MB and 1 GB. We recommend balancing around a 10 MB part size."),(0,n.kt)("p",null,"So if your binary was 1 GB:"),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"total_parts = ceil(1 GB / 10 MB) = 100 parts")),(0,n.kt)("admonition",{type:"tip"},(0,n.kt)("p",{parentName:"admonition"},"It is likely that your binary's size is not an exact multiple of your target part size. In this case one of your binary parts, typically the last, will be smaller than the target part size."),(0,n.kt)("p",{parentName:"admonition"},(0,n.kt)("inlineCode",{parentName:"p"},"total_parts = ceil(1.003 GB / 10 MB = 100.3 parts) = 101")),(0,n.kt)("p",{parentName:"admonition"},"The 101st part would be ",(0,n.kt)("inlineCode",{parentName:"p"},"0.003 GB")," or ",(0,n.kt)("inlineCode",{parentName:"p"},"3 MB")," in size.")),(0,n.kt)("h2",{id:"creating-a-part"},"Creating a Part"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"peridio binary-parts create \\\n  --binary-prn $PERIDIO_BINARY_PRN \\\n  --binary-content-path $PERIDIO_BINARY_CONTENT_PATH \\\n  --size $PERIDIO_PART_SIZE \\\n  --hash $PERIDIO_HASH\n")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"--binary-content-path")," points at the complete bianry, not any given chunk."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"--hash")," value can be calculated as documented in the ",(0,n.kt)("a",{parentName:"li",href:"/reference/signing-keys#create-a-hash-to-later-be-signed"},"create a hash to later be signed")," section of the signing keys reference.",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Exercise extreme caution regarding newlines and invisible characters, it is a common source of mistakes."))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"--size")," is the byte size of the part.")),(0,n.kt)("p",null,"If successful, this command will return a presigned URL you can use to upload the binary part's content."),(0,n.kt)("h2",{id:"uploading-a-part"},"Uploading a Part"),(0,n.kt)("p",null,"The following is an example curl command for uploading a binary part."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},'curl $PERIDIO_PRESIGNED_URL \\\n  -X PUT \\\n  -H "content-length: $(stat -f%z $PERIDIO_FILE)" \\\n  -H "content-type: application/octet-stream" \\\n  -H "x-amz-checksum-sha256: $(cat $PERIDIO_FILE | sha256sum | grep -o \'^\\S\\+\' | xxd -r -p | base64)" \\\n  --upload-file $PERIDIO_FILE\n')),(0,n.kt)("p",null,"Every specified header in that example is required."),(0,n.kt)("h2",{id:"listing-parts"},"Listing Parts"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"peridio binary-parts list \\\n  --binary-prn $PERIDIO_BINARY_PRN\n")))}d.isMDXComponent=!0}}]);