"use strict";(self.webpackChunkparasola=self.webpackChunkparasola||[]).push([[161],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return d}});var i=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var o=i.createContext({}),l=function(e){var t=i.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},p=function(e){var t=l(e.components);return i.createElement(o.Provider,{value:t},e.children)},f={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},u=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,o=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=l(n),d=a,m=u["".concat(o,".").concat(d)]||u[d]||f[d]||r;return n?i.createElement(m,c(c({ref:t},p),{},{components:n})):i.createElement(m,c({ref:t},p))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,c=new Array(r);c[0]=u;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s.mdxType="string"==typeof e?e:a,c[1]=s;for(var l=2;l<r;l++)c[l]=n[l];return i.createElement.apply(null,c)}return i.createElement.apply(null,n)}u.displayName="MDXCreateElement"},89692:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return o},default:function(){return d},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return f}});var i=n(83117),a=n(80102),r=(n(67294),n(3905)),c=["components"],s={},o="Creating X.509 Certificates with OpenSSL",l={unversionedId:"guides/creating-x509-certificates-with-openssl",id:"guides/creating-x509-certificates-with-openssl",title:"Creating X.509 Certificates with OpenSSL",description:"This guide describes how to create X.509 certificates with the OpenSSL CLI.",source:"@site/cremini/docs/guides/creating-x509-certificates-with-openssl.md",sourceDirName:"guides",slug:"/guides/creating-x509-certificates-with-openssl",permalink:"/cremini/guides/creating-x509-certificates-with-openssl",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"guides"},p={},f=[{value:"Private and Public Keys",id:"private-and-public-keys",level:2},{value:"Inspect a Private Key",id:"inspect-a-private-key",level:3},{value:"Create Certificates",id:"create-certificates",level:2},{value:"Inspect a Certificate",id:"inspect-a-certificate",level:3},{value:"Root",id:"root",level:3},{value:"Create a Private Key",id:"create-a-private-key",level:4},{value:"Create a Certificate",id:"create-a-certificate",level:4},{value:"Intermediate",id:"intermediate",level:3},{value:"Create a Private Key",id:"create-a-private-key-1",level:4},{value:"Create a Certificate",id:"create-a-certificate-1",level:4},{value:"End-entity Certificate",id:"end-entity-certificate",level:3},{value:"Create a Private Key",id:"create-a-private-key-2",level:4},{value:"Create a Certificate",id:"create-a-certificate-2",level:4},{value:"Appendix",id:"appendix",level:2},{value:"A - openssl.cnf",id:"a---opensslcnf",level:3},{value:"References",id:"references",level:2},{value:"config",id:"config",level:3},{value:"openssl-ecparam",id:"openssl-ecparam",level:3},{value:"openssl-req",id:"openssl-req",level:3},{value:"openssl-x509",id:"openssl-x509",level:3},{value:"x509v3_config",id:"x509v3_config",level:3},{value:"RFC 4158",id:"rfc-4158",level:3},{value:"RFC 5280",id:"rfc-5280",level:3}],u={toc:f};function d(e){var t=e.components,n=(0,a.Z)(e,c);return(0,r.kt)("wrapper",(0,i.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"creating-x509-certificates-with-openssl"},"Creating X.509 Certificates with OpenSSL"),(0,r.kt)("p",null,"This guide describes how to create X.509 certificates with the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/openssl/openssl"},"OpenSSL CLI"),"."),(0,r.kt)("p",null,"Last tested with OpenSSL 3.0.4 21 Jun 2022."),(0,r.kt)("h2",{id:"private-and-public-keys"},"Private and Public Keys"),(0,r.kt)("p",null,"Every X.509 certificate has a public key within it. The public key is derived from a private key. When considered together they are referred to as an asymetric key pair. Generally, this field is refered to as ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Public-key_cryptography"},"public-key cryptography")," or asymmetric cryptography."),(0,r.kt)("p",null,"To create an asymmetric key pair, one must first decide on a public key algorithm to use, this choice dictates:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The cryptographic properties of the keys and in turn their capabilities and security guarantees."),(0,r.kt)("li",{parentName:"ul"},"The processes required to create and interact with the keys.")),(0,r.kt)("p",null,"This guide will use the ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Elliptic_Curve_Digital_Signature_Algorithm"},"ECDSA")," public key algorithm, but RSA and DSA are other common choices."),(0,r.kt)("p",null,"Effective security requires keeping the private key private; the public key can be openly distributed without compromising security."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"WARNING:"))," Private keys are sensitive components of a public key infrastructure. If they are leaked the entire downstream chain of trust is fundamentally compromised."),(0,r.kt)("h3",{id:"inspect-a-private-key"},"Inspect a Private Key"),(0,r.kt)("p",null,"To inspect any private key created later in this guide:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"openssl ecparam \\\n  -in key.pem \\\n  -text \\\n  -noout\n")),(0,r.kt)("h2",{id:"create-certificates"},"Create Certificates"),(0,r.kt)("p",null,"Some of the commands below will reference a file, ",(0,r.kt)("inlineCode",{parentName:"p"},"openssl.cnf"),", this is available at ",(0,r.kt)("a",{parentName:"p",href:"#a---opensslcnf"},"Appendix A"),"."),(0,r.kt)("h3",{id:"inspect-a-certificate"},"Inspect a Certificate"),(0,r.kt)("p",null,"To inspect any certificate created later in this guide:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"openssl x509 \\\n  -in certificate.pem \\\n  -text \\\n  -noout\n")),(0,r.kt)("h3",{id:"root"},"Root"),(0,r.kt)("p",null,"Generally speaking, a root certificate authority is a certificate that:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"is self-signed"),(0,r.kt)("li",{parentName:"ul"},"is capable of signing certificates")),(0,r.kt)("h4",{id:"create-a-private-key"},"Create a Private Key"),(0,r.kt)("p",null,"Reference ",(0,r.kt)("a",{parentName:"p",href:"#openssl-ecparam"},"openssl-ecparam"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"openssl ecparam \\\n  -genkey \\\n  -name prime256v1 \\\n  -out root-private-key.pem\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"WARNING:"))," Private keys are sensitive components of a public key infrastructure. If they are leaked the entire downstream chain of trust is fundamentally compromised."),(0,r.kt)("h4",{id:"create-a-certificate"},"Create a Certificate"),(0,r.kt)("p",null,"Reference ",(0,r.kt)("a",{parentName:"p",href:"#openssl-req"},"openssl-req"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'openssl req \\\n  -config openssl.cnf \\\n  -days 3650 \\\n  -key root-private-key.pem \\\n  -new \\\n  -out root-certificate.pem \\\n  -section root_certificate_authority_req \\\n  -subj "/CN=unique-root-name" \\\n  -x509\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"WARNING:"))," The ",(0,r.kt)("inlineCode",{parentName:"p"},"-days")," option should be specified cautiously as it dictates how long the certificate will be valid for. The impact of a certificate expiring is dependent on the parties interacting with it. For information regarding how Peridio interacts with certificates reference ",(0,r.kt)("a",{parentName:"p",href:"/cremini/reference/ca-certificates"},"CA Certificates")," and ",(0,r.kt)("a",{parentName:"p",href:"/cremini/reference/device-certificates"},"Device Certificates"),"."),(0,r.kt)("p",null,"The certificate can be openly distributed without compromising security."),(0,r.kt)("h3",{id:"intermediate"},"Intermediate"),(0,r.kt)("p",null,"Generally speaking, an intermediate certificate authority is a certificate that:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"is not self signed"),(0,r.kt)("li",{parentName:"ul"},"is signed either by an intermediate certificate authority or a root certificate authority"),(0,r.kt)("li",{parentName:"ul"},"is capable of signing certificates")),(0,r.kt)("h4",{id:"create-a-private-key-1"},"Create a Private Key"),(0,r.kt)("p",null,"Reference ",(0,r.kt)("a",{parentName:"p",href:"#openssl-ecparam"},"openssl-ecparam"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"openssl ecparam \\\n  -genkey \\\n  -name prime256v1 \\\n  -out intermediate-private-key.pem\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"WARNING:"))," Private keys are sensitive components of a public key infrastructure. If they are leaked the entire downstream chain of trust is fundamentally compromised."),(0,r.kt)("h4",{id:"create-a-certificate-1"},"Create a Certificate"),(0,r.kt)("p",null,"Reference ",(0,r.kt)("a",{parentName:"p",href:"#openssl-req"},"openssl-req"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'openssl req \\\n  -CA root-certificate.pem \\\n  -CAkey root-private-key.pem \\\n  -config openssl.cnf \\\n  -days 3650 \\\n  -key intermediate-private-key.pem \\\n  -new \\\n  -out intermediate-certificate.pem \\\n  -section intermediate_certificate_authority_req \\\n  -subj "/CN=unique-intermediate-name" \\\n  -x509\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"WARNING:"))," The ",(0,r.kt)("inlineCode",{parentName:"p"},"-days")," option should be specified cautiously as it dictates how long the certificate will be valid for. The impact of a certificate expiring is dependent on the parties interacting with it. For information regarding how Peridio interacts with certificates reference ",(0,r.kt)("a",{parentName:"p",href:"/cremini/reference/ca-certificates"},"CA Certificates")," and ",(0,r.kt)("a",{parentName:"p",href:"/cremini/reference/device-certificates"},"Device Certificates"),"."),(0,r.kt)("p",null,"Note the ",(0,r.kt)("inlineCode",{parentName:"p"},"-CA")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"-CAkey")," options; these indicate the certificate that will issue and sign the certificate you are creating. In this case we create an intermediate from a root, but you may also create an intermediate from another intermediate."),(0,r.kt)("p",null,"The certificate can be openly distributed without compromising security."),(0,r.kt)("h3",{id:"end-entity-certificate"},"End-entity Certificate"),(0,r.kt)("p",null,"Generally speaking, an end-entity certificate is a certificate that:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"is not self signed"),(0,r.kt)("li",{parentName:"ul"},"is signed by either an intermediate certificate authority or a root certificate authority"),(0,r.kt)("li",{parentName:"ul"},"is not capable of signing certificates")),(0,r.kt)("h4",{id:"create-a-private-key-2"},"Create a Private Key"),(0,r.kt)("p",null,"Reference ",(0,r.kt)("a",{parentName:"p",href:"#openssl-ecparam"},"openssl-ecparam"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"openssl ecparam \\\n  -genkey \\\n  -name prime256v1 \\\n  -out end-entity-private-key.pem\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"WARNING:"))," Private keys are sensitive components of a public key infrastructure. If they are leaked the entire downstream chain of trust is fundamentally compromised."),(0,r.kt)("h4",{id:"create-a-certificate-2"},"Create a Certificate"),(0,r.kt)("p",null,"Reference ",(0,r.kt)("a",{parentName:"p",href:"#openssl-req"},"openssl-req"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'openssl req \\\n  -CA intermediate-certificate.pem \\\n  -CAkey intermediate-private-key.pem \\\n  -config openssl.cnf \\\n  -days 398 \\\n  -key end-entity-private-key.pem \\\n  -new \\\n  -out end-entity-certificate.pem \\\n  -section end_entity_certificate_req \\\n  -subj "/CN=unique-end-entity-name" \\\n  -x509\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"WARNING:"))," The ",(0,r.kt)("inlineCode",{parentName:"p"},"-days")," option should be specified cautiously as it dictates how long the certificate will be valid for. The impact of a certificate expiring is dependent on the parties interacting with it. For information regarding how Peridio interacts with certificates reference ",(0,r.kt)("a",{parentName:"p",href:"/cremini/reference/ca-certificates"},"CA Certificates")," and ",(0,r.kt)("a",{parentName:"p",href:"/cremini/reference/device-certificates"},"Device Certificates"),"."),(0,r.kt)("p",null,"Note the ",(0,r.kt)("inlineCode",{parentName:"p"},"-CA")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"-CAkey")," options; these indicate the certificate that will issue and sign the certificate you are creating. In this case we create an end entity from an intermediate, but you may also create an end entity from a root."),(0,r.kt)("p",null,"The certificate can be openly distributed without compromising security."),(0,r.kt)("h2",{id:"appendix"},"Appendix"),(0,r.kt)("h3",{id:"a---opensslcnf"},"A - openssl.cnf"),(0,r.kt)("p",null,"When creating certificates and certificate signing requests there is often a set of common extensions you wish to include. It is convenient to enumerate these extensions in a config file for ease of maintenance and referenceability."),(0,r.kt)("p",null,"In this guide, we use the following config referenced as ",(0,r.kt)("inlineCode",{parentName:"p"},"openssl.cnf"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cnf"},"#\n# root\n#\n\n[ root_certificate_authority_req ]\nprompt=no\nx509_extensions=root_certificate_authority_extensions\n\n[ root_certificate_authority_extensions ]\nsubjectKeyIdentifier=hash\nauthorityKeyIdentifier=keyid:always\nbasicConstraints=critical,CA:TRUE\nkeyUsage=critical,digitalSignature,keyCertSign,cRLSign\nextendedKeyUsage=serverAuth,clientAuth\n\n#\n# intermediate\n#\n\n[ intermediate_certificate_authority_req ]\nprompt=no\nx509_extensions=intermediate_certificate_authority_extensions\n\n[ intermediate_certificate_authority_extensions ]\nbasicConstraints=critical,CA:TRUE,pathlen:0\nkeyUsage=critical,digitalSignature,keyCertSign,cRLSign\nextendedKeyUsage=serverAuth,clientAuth\nsubjectKeyIdentifier=hash\nauthorityKeyIdentifier=keyid:always\n\n#\n# end entity\n#\n\n[ end_entity_certificate_req ]\nprompt=no\nx509_extensions=end_entity_certificate_extensions\n\n[ end_entity_certificate_extensions ]\nauthorityKeyIdentifier=keyid:always\nextendedKeyUsage=clientAuth\nkeyUsage=critical,digitalSignature\nsubjectKeyIdentifier=hash\n")),(0,r.kt)("p",null,"For a comprehensive understanding of what the above configuration is doing, one should exhaustively read all of this guide's ",(0,r.kt)("a",{parentName:"p",href:"#references"},"references"),". If you find yourself in a position of having to manage PKI, this must be considered a required effort."),(0,r.kt)("h2",{id:"references"},"References"),(0,r.kt)("h3",{id:"config"},"config"),(0,r.kt)("p",null,"OpenSSL's CONF library configuration files, reference ",(0,r.kt)("a",{parentName:"p",href:"https://www.openssl.org/docs/manmaster/man5/config.html"},"https://www.openssl.org/docs/manmaster/man5/config.html"),"."),(0,r.kt)("h3",{id:"openssl-ecparam"},"openssl-ecparam"),(0,r.kt)("p",null,"OpenSSL's EC parameter manipulation and generation command, reference ",(0,r.kt)("a",{parentName:"p",href:"https://www.openssl.org/docs/manmaster/man1/openssl-ecparam.html"},"https://www.openssl.org/docs/manmaster/man1/openssl-ecparam.html"),"."),(0,r.kt)("h3",{id:"openssl-req"},"openssl-req"),(0,r.kt)("p",null,"OpenSSL's PKCS#10 certificate request and certificate generating command, reference ",(0,r.kt)("a",{parentName:"p",href:"https://www.openssl.org/docs/manmaster/man1/openssl-req.html"},"https://www.openssl.org/docs/manmaster/man1/openssl-req.html"),"."),(0,r.kt)("h3",{id:"openssl-x509"},"openssl-x509"),(0,r.kt)("p",null,"OpenSSL's certificate display and signing command, reference ",(0,r.kt)("a",{parentName:"p",href:"https://www.openssl.org/docs/manmaster/man1/openssl-x509.html"},"https://www.openssl.org/docs/manmaster/man1/openssl-x509.html"),"."),(0,r.kt)("h3",{id:"x509v3_config"},"x509v3_config"),(0,r.kt)("p",null,"OpenSSL's X509 V3 certificate extension configuration format, reference ",(0,r.kt)("a",{parentName:"p",href:"https://www.openssl.org/docs/manmaster/man5/x509v3_config.html"},"https://www.openssl.org/docs/manmaster/man5/x509v3_config.html"),"."),(0,r.kt)("h3",{id:"rfc-4158"},"RFC 4158"),(0,r.kt)("p",null,"Internet X.509 Public Key Infrastructure: Certification Path Building, reference ",(0,r.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc4158"},"https://datatracker.ietf.org/doc/html/rfc4158"),"."),(0,r.kt)("h3",{id:"rfc-5280"},"RFC 5280"),(0,r.kt)("p",null,"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile, reference ",(0,r.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc5280"},"https://datatracker.ietf.org/doc/html/rfc5280"),"."))}d.isMDXComponent=!0}}]);